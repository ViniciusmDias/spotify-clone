{"ast":null,"code":"import _slicedToArray from\"/home/vinicius/projects/react-17/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useRef,useState}from'react';import{useDispatch,useSelector}from'react-redux';import{BsPauseFill,BsPlayFill}from'react-icons/bs';import Ink from'react-ink';import{removeTrackToPlayer,setPlayerHeight}from'../../actions';import{usePrevious}from'../../modules/custom-hook';import'./Player.scss';var Player=function Player(){var _playerRef$current,_currentTrack$album,_currentTrack$album$i;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),currentTrack=_useState2[0],setCurrentTrack=_useState2[1];var playingNowId=useSelector(function(state){return state.content.playingNowId;});var playingNowTrack=useSelector(function(state){return state.content.playingNowTrack;});var dispatch=useDispatch();var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),isPlaying=_useState4[0],setIsPlaying=_useState4[1];var _useState5=useState('0%'),_useState6=_slicedToArray(_useState5,2),progressBarWidth=_useState6[0],setProgressBarWidth=_useState6[1];var prevPlayingNowId=usePrevious(playingNowId);var audioElementRef=useRef(null);var playerRef=useRef(null);var playerHeight=(playerRef===null||playerRef===void 0?void 0:(_playerRef$current=playerRef.current)===null||_playerRef$current===void 0?void 0:_playerRef$current.offsetHeight)||0;var togglePlayPause=function togglePlayPause(){var audioPlayer=audioElementRef.current;if(isPlaying&&!audioPlayer.paused){setIsPlaying(false);}else if(!isPlaying&&audioPlayer.paused){setIsPlaying(true);}};var handleTimeUpdate=function handleTimeUpdate(){var audioPlayer=audioElementRef.current;var width=Math.floor(audioPlayer.currentTime/audioPlayer.duration*100)+'%';setProgressBarWidth(width);};var handleOnEnded=function handleOnEnded(){dispatch(removeTrackToPlayer());};useEffect(function(){if(playingNowId===prevPlayingNowId){return;}setCurrentTrack(playingNowTrack);},[playingNowId,prevPlayingNowId,playingNowTrack]);useEffect(function(){var audioPlayer=audioElementRef.current;if(prevPlayingNowId===playingNowId){if(isPlaying&&(audioPlayer===null||audioPlayer===void 0?void 0:audioPlayer.paused)){audioPlayer.play();}if(!isPlaying&&!(audioPlayer===null||audioPlayer===void 0?void 0:audioPlayer.paused)){audioPlayer.pause();}}else{setIsPlaying(true);}},[isPlaying,playingNowId,prevPlayingNowId]);useEffect(function(){if(playerHeight>0){dispatch(setPlayerHeight(playerHeight));}},[isPlaying,dispatch,playerHeight]);return/*#__PURE__*/React.createElement(\"div\",{ref:playerRef,className:\"player \".concat(currentTrack?'is-playing':''),\"data-testid\":\"player\"},currentTrack&&/*#__PURE__*/React.createElement(\"div\",{className:\"player__wrapper\"},/*#__PURE__*/React.createElement(\"div\",{className:\"player__progress-bar\"},/*#__PURE__*/React.createElement(\"div\",{className:\"player__progress-bar__stroke\",style:{width:\"\".concat(progressBarWidth)}})),/*#__PURE__*/React.createElement(\"div\",{className:\"container\"},/*#__PURE__*/React.createElement(\"figure\",{className:\"player__album-cover\",style:{backgroundImage:\"url(\".concat(((_currentTrack$album=currentTrack.album)===null||_currentTrack$album===void 0?void 0:(_currentTrack$album$i=_currentTrack$album.images[1])===null||_currentTrack$album$i===void 0?void 0:_currentTrack$album$i.url)||'',\")\")}}),/*#__PURE__*/React.createElement(\"div\",{className:\"player__status\"},/*#__PURE__*/React.createElement(\"div\",{className:\"player__artist\"},/*#__PURE__*/React.createElement(\"span\",{className:\"player__music\"},currentTrack.name),/*#__PURE__*/React.createElement(\"span\",{className:\"player__artists\"},currentTrack.artists&&currentTrack.artists.map(function(_ref){var name=_ref.name;return name;}).join(', ')),/*#__PURE__*/React.createElement(\"div\",{className:\"player__status__current \".concat(isPlaying?'is-playing':'')},/*#__PURE__*/React.createElement(\"span\",null,\"Pausado\"),/*#__PURE__*/React.createElement(\"span\",null,\"Reproduzindo\")))),/*#__PURE__*/React.createElement(\"div\",{className:\"player__controls\",onClick:togglePlayPause},/*#__PURE__*/React.createElement(\"div\",{className:\"player__control \".concat(!isPlaying?'is-paused':'')},!isPlaying?/*#__PURE__*/React.createElement(BsPlayFill,null):/*#__PURE__*/React.createElement(BsPauseFill,null),/*#__PURE__*/React.createElement(Ink,null)))),/*#__PURE__*/React.createElement(\"audio\",{ref:audioElementRef,autoPlay:true,onEnded:handleOnEnded,onTimeUpdate:handleTimeUpdate,preload:\"metadata\",src:currentTrack.preview_url})));};export default Player;","map":{"version":3,"sources":["/home/vinicius/projects/react-17/src/containers/Player/Player.jsx"],"names":["React","useEffect","useRef","useState","useDispatch","useSelector","BsPauseFill","BsPlayFill","Ink","removeTrackToPlayer","setPlayerHeight","usePrevious","Player","currentTrack","setCurrentTrack","playingNowId","state","content","playingNowTrack","dispatch","isPlaying","setIsPlaying","progressBarWidth","setProgressBarWidth","prevPlayingNowId","audioElementRef","playerRef","playerHeight","current","offsetHeight","togglePlayPause","audioPlayer","paused","handleTimeUpdate","width","Math","floor","currentTime","duration","handleOnEnded","play","pause","backgroundImage","album","images","url","name","artists","map","join","preview_url"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport {\n  BsPauseFill,\n  BsPlayFill,\n} from 'react-icons/bs';\nimport Ink from 'react-ink';\n\nimport { removeTrackToPlayer, setPlayerHeight } from '../../actions';\nimport { usePrevious } from '../../modules/custom-hook';\n\nimport './Player.scss';\n\nconst Player = () => {\n  const [currentTrack, setCurrentTrack] = useState(null);\n  const playingNowId = useSelector(state => state.content.playingNowId);\n  const playingNowTrack = useSelector(state => state.content.playingNowTrack);\n  const dispatch = useDispatch();\n  const [isPlaying, setIsPlaying] = useState(true);\n  const [progressBarWidth, setProgressBarWidth] = useState('0%');\n  const prevPlayingNowId = usePrevious(playingNowId);\n  const audioElementRef = useRef(null);\n  const playerRef = useRef(null);\n  const playerHeight = playerRef?.current?.offsetHeight || 0;\n\n  const togglePlayPause = () => {\n    const audioPlayer = audioElementRef.current;\n\n    if (isPlaying && !audioPlayer.paused) {\n      setIsPlaying(false);\n    }\n    else if (!isPlaying && audioPlayer.paused) {\n      setIsPlaying(true);\n    }\n  }\n\n  const handleTimeUpdate = () => {\n    const audioPlayer = audioElementRef.current;\n    const width = Math.floor((audioPlayer.currentTime / audioPlayer.duration) * 100) + '%';\n\n    setProgressBarWidth(width);\n  }\n\n  const handleOnEnded = () => {\n    dispatch(removeTrackToPlayer());\n  }\n\n  useEffect(() => {\n    if (playingNowId === prevPlayingNowId) {\n      return;\n    }\n\n    setCurrentTrack(playingNowTrack);\n  }, [playingNowId, prevPlayingNowId, playingNowTrack]);\n\n  useEffect(() => {\n    const audioPlayer = audioElementRef.current;\n\n    if (prevPlayingNowId === playingNowId) {\n      if (isPlaying && audioPlayer?.paused) {\n        audioPlayer.play();\n      }\n\n      if (!isPlaying && !audioPlayer?.paused) {\n        audioPlayer.pause();\n      }\n    }\n    else {\n      setIsPlaying(true);\n    }\n  }, [isPlaying, playingNowId, prevPlayingNowId]);\n\n  useEffect(() => {\n    if (playerHeight > 0) {\n      dispatch(setPlayerHeight(playerHeight))\n    }\n  }, [isPlaying, dispatch, playerHeight])\n\n  return (\n    <div\n      ref={playerRef}\n      className={`player ${currentTrack ? 'is-playing' : ''}`}\n      data-testid=\"player\"\n    >\n      {currentTrack && (\n        <div className=\"player__wrapper\">\n          <div className=\"player__progress-bar\">\n            <div\n              className=\"player__progress-bar__stroke\"\n              style={{width: `${progressBarWidth}`}}\n            />\n          </div>\n\n          <div className=\"container\">\n            <figure\n              className=\"player__album-cover\"\n              style={{ backgroundImage: `url(${currentTrack.album?.images[1]?.url || ''})` }}\n            />\n\n            <div className=\"player__status\">\n              <div className=\"player__artist\">\n                <span className=\"player__music\">\n                  {currentTrack.name}\n                </span>\n\n                <span className=\"player__artists\">\n                  {currentTrack.artists && currentTrack.artists.map(({ name }) => name).join(', ')}\n                </span>\n\n                <div className={`player__status__current ${isPlaying ? 'is-playing' : ''}`}>\n                  <span>Pausado</span>\n                  <span>Reproduzindo</span>\n                </div>\n              </div>\n            </div>\n\n            <div\n              className=\"player__controls\"\n              onClick={togglePlayPause}\n            >\n              <div className={`player__control ${!isPlaying ? 'is-paused' : ''}`}>\n                {!isPlaying\n                  ? (<BsPlayFill />)\n                  : (<BsPauseFill />)\n                }\n                <Ink />\n              </div>\n            </div>\n          </div>\n\n          <audio\n            ref={audioElementRef}\n            autoPlay\n            onEnded={handleOnEnded}\n            onTimeUpdate={handleTimeUpdate}\n            preload=\"metadata\"\n            src={currentTrack.preview_url}\n          />\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default Player;"]},"metadata":{},"sourceType":"module"}